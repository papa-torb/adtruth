var AdTruth=function(){"use strict";function t(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function e(){const e="_adtruth_session";try{let i=sessionStorage.getItem(e);return i||(i=t(),sessionStorage.setItem(e,i)),i}catch(e){return t()}}function i(){const e="_adtruth_visitor";try{let i=localStorage.getItem(e);return i||(i=t(),localStorage.setItem(e,i)),i}catch(i){try{let i=sessionStorage.getItem(e);return i||(i=t(),sessionStorage.setItem(e,i)),i}catch(e){return t()}}}function n(){const t={screen:`${screen.width}x${screen.height}x${screen.colorDepth}`,timezone:r(),timezoneOffset:(new Date).getTimezoneOffset(),hardwareConcurrency:navigator.hardwareConcurrency||0,deviceMemory:navigator.deviceMemory||0};return{hash:function(t){const e=JSON.stringify(t);let i=0;for(let t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i&=i;return Math.abs(i).toString(36)}(t),details:t}}function r(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(t){return"unknown"}}class a{constructor(){this.pageLoadTime=Date.now(),this.firstInteractionTime=null,this.lastInteractionTime=null,this.clickCount=0,this.clickTimes=[],this.setupListeners()}setupListeners(){document.addEventListener("click",this.handleClick.bind(this),{passive:!0});const t=()=>{this.firstInteractionTime||(this.firstInteractionTime=Date.now())};["click","keydown","touchstart","mousemove"].forEach(e=>{document.addEventListener(e,t,{passive:!0,once:!0})})}handleClick(t){const e=Date.now();this.clickCount++,this.clickTimes.push(e),this.lastInteractionTime=e,this.clickTimes.length>20&&this.clickTimes.shift()}calculateAvgInterval(){if(this.clickTimes.length<2)return null;let t=0;for(let e=1;e<this.clickTimes.length;e++)t+=this.clickTimes[e]-this.clickTimes[e-1];return Math.round(t/(this.clickTimes.length-1))}getMetrics(){return{timeOnPage:Date.now()-this.pageLoadTime,timeToFirstInteraction:this.firstInteractionTime?this.firstInteractionTime-this.pageLoadTime:null,timeToFirstClick:this.clickTimes.length>0?this.clickTimes[0]-this.pageLoadTime:null,clickCount:this.clickCount,avgClickInterval:this.calculateAvgInterval(),hasInteracted:null!==this.firstInteractionTime}}cleanup(){}}const o=new class{constructor(){this.apiKey=null,this.apiEndpoint="https://api.adtruth.io/track/",this.initialized=!1,this.debug=!1,this.behaviorTracker=null,this.fingerprint=null}init(t,e={}){this.initialized||(t?(this.apiKey=t,this.debug=e.debug||!1,e.endpoint&&(this.apiEndpoint=e.endpoint),this.initialized=!0,this.log("AdTruth: Initialized"),this.behaviorTracker=new a,this.fingerprint=n(),this.track()):this.log("AdTruth: API key is required"))}track(t="pageview"){if(!this.initialized)return void this.log("AdTruth: Not initialized. Call init() first.");const e=this.collectData(t);this.sendData(e)}collectData(t){const n=window.location.href,r=function(t){const e={};try{const i=new URL(t).searchParams;["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(t=>{const n=i.get(t);n&&(e[t]=n)});const n=i.get("gclid");n&&(e.gclid=n);const r=i.get("fbclid");r&&(e.fbclid=r)}catch(t){}return e}(n),a={user_agent:navigator.userAgent,language:navigator.language,languages:navigator.languages?Array.from(navigator.languages).join(","):"",platform:navigator.platform,vendor:navigator.vendor||"",cookieEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack||"unknown",maxTouchPoints:navigator.maxTouchPoints||0,hardwareConcurrency:navigator.hardwareConcurrency||0,deviceMemory:navigator.deviceMemory||0},o=function(){const t="ontouchstart"in window,e="undefined"!=typeof matchMedia&&matchMedia("(pointer: fine)").matches,i="undefined"!=typeof matchMedia&&matchMedia("(hover: hover)").matches;return{hasTouch:t,hasMouse:e,hasHover:i,maxTouchPoints:navigator.maxTouchPoints||0,inputInconsistency:t&&e&&i}}(),s=this.behaviorTracker?this.behaviorTracker.getMetrics():{};return{event_type:t,timestamp:(new Date).toISOString(),session_id:e(),visitor_id:i(),page:{url:n,title:document.title||"",referrer:document.referrer||""},utm:{source:r.utm_source||null,medium:r.utm_medium||null,campaign:r.utm_campaign||null,term:r.utm_term||null,content:r.utm_content||null},click_ids:{gclid:r.gclid||null,fbclid:r.fbclid||null},browser:{...a,screen:{width:screen.width,height:screen.height,colorDepth:screen.colorDepth},viewport:{width:window.innerWidth,height:window.innerHeight}},fingerprint:{hash:this.fingerprint?this.fingerprint.hash:null,timezone:this.fingerprint?this.fingerprint.details.timezone:null,timezoneOffset:this.fingerprint?this.fingerprint.details.timezoneOffset:null},input:o,behavior:s}}sendData(t){const e=JSON.stringify(t);this.sendViaFetch(e)}sendViaFetch(t){fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.apiKey},body:t,keepalive:!0}).then(()=>{this.log("AdTruth: Data sent via fetch")}).catch(t=>{this.log("AdTruth: Failed to send data",t)})}log(...t){this.debug&&"undefined"!=typeof console&&console.log&&console.log(...t)}},s={init:function(t,e){o.init(t,e)},trackPageview:function(){o.track("pageview")},track:function(t,e){o.track(t||"pageview")},version:"0.1.0"};
/**
   * AdTruth SDK - Open-source fraud detection for paid advertising
   * @version 0.1.0
   * @license MIT
   */return"undefined"!=typeof document&&document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector("script[data-adtruth-api-key]");if(t){const e=t.getAttribute("data-adtruth-api-key"),i="true"===t.getAttribute("data-adtruth-debug");s.init(e,{debug:i})}}),s}();
